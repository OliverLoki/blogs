

**引言**

本文以 `MySQL 8.0.23` 为例，简单介绍MySQL的逻辑架构，Mysql安装，Mysql目录结构

> MySQL是一个典型的C/S架构程序，MySQL Server提供数据库服务，完成客户端的请求和操作，Client负责连接到Server。
>
> MySQL和其他关系型数据库不一样的地方在于它的弹性以及可以通过插件形式提供不同种类的存储引擎，MySQL请求处理过程会根据不同的存储引擎发生变化，比如事务性的InnoDB和非事务性的MyISAM，数据的存储和SQL的执行会产生很大的差异

## MySQL逻辑架构

**MySQL逻辑系统架构分为3层**

1. **应用层**

   **应用层是MySQL体系架构的最上层，它可其他client-server架构一样，主要包含如下内容**

   - **连接处理**
   - **用户鉴权**
   - **安全管理**

2. **MySQL服务层（下文详解）**

3. **存储引擎层（下文详解）**

> **下图是 MySQL 的一个简要逻辑架构图**

![image-20220423180507286](https://s2.loli.net/2022/04/23/RLYAF4tzNVxEClb.png)

+ **连接器** :身份认证和权限相关(登录 MySQL 的时候)
+ **查询缓存**: 执行查询语句的时候，会先查询缓存（MySQL 8.0 版本后移除，因为这个功能不太实用）
+ **分析器**:没有命中缓存的话，SQL 语句就会经过分析器，分析器说白了就是要先看你的 SQL 语句要干嘛，再检查你的 SQL 语句语法是否正确
+ **优化器** :按照 MySQL 认为最优的方案去执行。
+ **执行器:** 执行语句，然后从存储引擎返回数据

**附：有能力可以理解一下这张图**

![image-20220423190427350](https://s2.loli.net/2022/04/23/SJ4Zq56uOhbBeNM.png)

### Server 层基本组件介绍

**引言**

**Server 层**主要包括连接器、查询缓存、分析器、优化器、执行器等，所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图，函数等，还有一个通用的日志模块 binglog 日志模块

> **连接器**

连接器主要和身份认证和权限相关的功能相关，就好比一个级别很高的门卫一样。

主要负责用户登录数据库，进行用户的身份认证，包括校验账户密码，权限等操作，如果用户账户密码已通过，连接器会到权限表中查询该用户的所有权限，之后在这个连接里的权限逻辑判断都是会依赖此时读取到的权限数据，也就是说，后续只要这个连接不断开，即时管理员修改了该用户的权限，该用户也是不受影响的。

> **分析器**

`MySQL 8` 连接通过，就会进入分析器，分析器主要是用来分析 SQL 语句是来干嘛的，分析器也会分为几步：

**第一步，词法分析**，一条 SQL 语句有多个字符串组成，首先要提取关键字，比如 select，提出查询的表，提出字段名，提出查询条件等等。做完这些操作后，就会进入第二步。

**第二步，语法分析**，主要就是判断你输入的 sql 是否正确，是否符合 MySQL 的语法。

完成这两步之后，MySQL 就准备开始执行了，但是如何执行，怎么执行是最好的结果呢？这个时候就需要优化器上场了。

> **优化器**

优化器的作用就是它认为的最优的执行方案去执行（有时候可能也不是最优，这篇文章涉及对这部分知识的深入讲解），比如多个索引的时候该如何选择索引，多表查询的时候如何选择关联顺序等。

可以说，经过了优化器之后可以说这个语句具体该如何执行就已经定下来。

> **执行器**

当选择了执行方案后，MySQL 就准备开始执行了，首先执行前会校验该用户有没有权限，如果没有权限，就会返回错误信息，如果有权限，就会去调用引擎的接口，返回接口执行的结果

### 关于存储引擎

**引言**

> 存储引擎主要负责数据的存储和读取，**存储引擎是MySQL中具体与文件系统打交道的子系统**，也是MySQL最有特色的地方。MySQL区别于其他数据库的最重要特点是其插件式的表存储引擎
>
> 
>
> **采用可以替换的插件式架构，支持 InnoDB、MyISAM、Memory 等多个存储引擎，其中 InnoDB 引擎有自有的日志模块 redolog 模块。现在最常用的存储引擎是 InnoDB，它从 MySQL 5.5.5 版本开始就被当做默认存储引擎了。**

> **InnoDB的学习**

+ 基于磁盘的资源是InnoDB表空间数据文件和它的日志文件，InnoDB 表的大小只受限于操作系统文件的大小，一般为 2GB
+ InnoDB提供事务支持事务，外部键（foreign key）等高级数据库功能
+ **DELETE  FROM table**时，InnoDB不会重新建立表，而是一行一行的删除



注：登录Mysql ，执行以下命令查看存储引擎

```
show engines;
```

![image-20220423181547327](https://s2.loli.net/2022/04/23/gOAC1vTHfX5Limp.png)

## MySQL目录结构（Win版本）

### 简单聊一下MySQL的安装

**首先简单聊一下`MySQL8`版本以上的安装，不会很细化，当作复习用**

推荐下载解压版自己配置，别用msi安装

1. 官网下载[MySQL Community Downloads](https://dev.mysql.com/downloads/)=download==>`Windows (x86, 64-bit), ZIP Archive`

2. 解压到你的工作目录，配置MySQL根目录到环境变量

3. 在根目录下新建并配置 `my.ini` 文件（Windows 系统环境下 MySQL 的这个配置文件叫 `my.ini `，但是在 CentOS 系统环境下这个配置文件就叫 `my.cnf` ，他们的后缀不同，但是里面的配置项基本上都是相通的）

4. 关于MySQL数据文件夹的说明

   根目录新建一个data文件夹，默认数据信息就会在这个data文件夹中,在my.ini中配置``datadir='你的data文件夹路径'`,数据库记录的所有信息都会放到这个data文件夹里面

   > **查看mysql数据库数据的存放目录**

   ```
   show variables like 'datadir'; 
   ```

   ![image-20220423191219672](https://s2.loli.net/2022/05/18/gxUmCQ2IMOJNP3n.png)

5. 初始化安装

   ```
   #初始化安装
   mysqld --initialize --console
    
   #安装mysql服务（服务名可以自定义，也可以省略）
   mysqld --install [服务名]
   
   #启动mysql服务
   net start mysql
   ```

### 目录结构分析

至此，MySQL的目录结构如下所示

![image-20220423194610105](https://s2.loli.net/2022/04/23/emuWBwCLREqknX4.png)



+ bin

  用于放置一些可执行文件，如 mysql.exe、mysqld.exe、mysqlshow.exe 等

+ data

  mysql的数据文件日志文件等

+ lib

  用于放置所需要的一些jar包

+ include q

  用于放置C语言的一些头文件，如：mysql.h、mysql_ername.h 等

+ my.ini

  my.ini 是 MySQL 默认使用的配置文件，一般情况下，只要修改 my.ini 配置文件中的内容就可以对 MySQL 进行配置

+ share

  Mysql的一些错误信息



**推荐阅读**

[Understand MySQL](https://www.rathishkumar.in/2016/04/understanding-mysql-architecture.html)

