## 网络层IP协议

+ 网络层协议，网络层向上尽最大努力提供数据报，不检查数据部分，只检查数据报首部
+ 网络层及以上使用ip地址，网络层以下使用物理地址

+ ip地址存放在ip数据报中，与应用层数据一起交付，ip数据报一旦交给数据链路层，就被封装称为MAC帧，MAC帧在传输时使用的源地址和目标地址都是硬件地址，这两个信息被写在MAC帧的首部中

### IPV4地址

> ip地址的表示方式

<网络号>，<主机号>

> 分类的ip地址

A类: 

B类: 

C类:

D类：ip多播

> IP数据报首部的各字段



### 划分子网

+ 对ip地址的主机号进行再划分，对外仍然是一个网络

+ 划分子网增加了灵活性，但是减少了能连接在网络上的主机总数

互联网规定，所有的网络都必须使用子网掩码，如果一个网络不划分子网，则使用默认的子网掩码

> 默认子网掩码如下所示

A类 255.0.0.0

B类 255.255.0.0

C类 255.255.255.0



### 无分类编址CIDR——构造超网

CIDR取消了传统 A类、B类、C类地址以及划分子网的概念，从而能更加有效的利用IPv的地址空间

无分类的两级编址记法：`<网络前缀><主机号>`



CIDR涉及到已分配的ip地址回收再分配，是一件十分困难的事，但是尽管这样，CIDR也推迟了 ip 地址耗尽的日期



### 与ip协议配套使用的三个协议

> ARP 地址解析协议

作用：通过ip地址解析出物理地址

方法：在`ARP cache`(高速缓存)中存放一个从IP地址到MAC地址的映射表，并且经常动态更新这个表

> ICMP 网际控制报文协议

ping就是一个例子

> IGMP 网际组管理协议





### 路由选择协议

> 内部网关协议和外部网关协议

内部

+ RIP
+ OSPF

外部

+ BGP-4





根据应用程序的要求，运输层需要两种不同的协议

+ 面向连接的TCP

+ 无连接的UDP：不提供可靠交付，但是某些情况下是最有效的工作方式

网络层为主机之间提供逻辑通信，运输层为应用进程之间提供端到端的逻辑通信

> 运输层向高层屏蔽了网络的细节，如（网络拓扑，采用的路由选择协议等），但是由于协议不同，对上层表现有很大的差异

+ TCP基于字节流，UDP基于报文

+ TCP: 可靠的全双工信道，无法实现广播/多播
+ UDP: 不可靠信道
+ UDP只在ip的数据报服务基础上增加了很少的功能,而TCP功能很多
  + 复用和分用
  + 差错检测
  + 尽最大努力交付

+ 首部只有八个字节，TCP首部有20个字节

## TCP协议



每一条TCP连接唯一的被通信两端的两个端点（两个套接字）确定

`{socket1,socket2}`

`socket = ip:端口号`



TCP可靠传输

+ 停止等待
+ 流水线传输
  + ARQ
  + 滑动窗口协议
+ TCP可靠传输

> 三报文握手
>
> TCP连接，就是在一次握手中交换了三个数据包，主要作用就是确定双方接受和发送消息的能力是否正常，双方可以共同协商一些参数

ACK：确认位，建立连接后TCP必须把ACK置为1

SYN: 同步位， ACK = 0 SYN = 1 表示请求连接报文段

ack: 确认号

seq: 初始序号



服务端

SYN = 1 ACK = 0 seq = x



客户端

+ 确认：ACK = 1 ack = x + 1 

+ 同步：SYN = y seq = y 



服务端

ACK = 1 



> 打电话说明三次数据包的交换

A: 喂，你能听到吗

B: 我能听到你呢

A: 我也可以



> 四报文挥手



















